use uom::si::{f64::*, pressure::megapascal, ratio::ratio, specific_heat_capacity::kilojoule_per_kilogram_kelvin, specific_volume::cubic_meter_per_kilogram};

pub(crate) fn t_ps_3a(p: Pressure, s: SpecificHeatCapacity) -> SpecificVolume {

    let v_ref = SpecificVolume::new::<cubic_meter_per_kilogram>(0.0028);
    let p_ref = Pressure::new::<megapascal>(100.0);
    let s_ref = SpecificHeatCapacity::new::<kilojoule_per_kilogram_kelvin>(4.4);

    let sigma: f64 = (s/s_ref).get::<ratio>();
    let pi: f64 = (p/p_ref).get::<ratio>();

    let mut omega = 0.0;

    for coeffs in T_PS_SUBREGION_3A_COEFFS {
        let ii = coeffs[0];
        let ji = coeffs[1];
        let ni = coeffs[2];

        omega += ni * (pi + 0.187).powf(ii) * (sigma - 0.755).powf(ji);
    };

    return omega * v_ref;
}

const T_PS_SUBREGION_3A_COEFFS: [[f64; 3]; 28] = [
    [-12.0, 10.0, 0.795_544_074_093_975e2],
    [-12.0, 12.0, -0.238_261_242_984_590e4],
    [-12.0, 14.0, 0.176_813_100_617_787e5],
    [-10.0, 4.0, -0.110_524_727_080_379e-2],
    [-10.0, 8.0, -0.153_213_833_655_326e2],
    [-10.0, 10.0, 0.297_544_599_376_982e3],
    [-10.0, 20.0, -0.350_315_206_871_242e8],
    [-8.0, 5.0, 0.277_513_761_062_119],
    [-8.0, 6.0, -0.523_964_271_036_888],
    [-8.0, 14.0, -0.148_011_182_995_403e6],
    [-8.0, 16.0, 0.160_014_899_374_266e7],
    [-6.0, 28.0, 0.170_802_322_663_427e13],
    [-5.0, 1.0, 0.246_866_996_006_494e-3],
    [-4.0, 5.0, 0.165_326_084_797_980e1],
    [-3.0, 2.0, -0.118_008_384_666_987],
    [-3.0, 4.0, 0.253_798_642_355_900e1],
    [-2.0, 3.0, 0.965_127_704_669_424],
    [-2.0, 8.0, -0.282_172_420_532_826e2],
    [-1.0, 1.0, 0.203_224_612_353_823],
    [-1.0, 2.0, 0.110_648_186_063_513e1],
    [0.0, 0.0, 0.526_127_948_451_280],
    [0.0, 1.0, 0.277_000_018_736_321],
    [0.0, 3.0, 0.108_153_340_501_132e1],
    [1.0, 0.0, -0.744_127_885_357_893e-1],
    [2.0, 0.0, 0.164_094_443_541_384e-1],
    [4.0, 2.0, -0.680_468_275_301_065e-1],
    [5.0, 2.0, 0.257_988_576_101_640e-1],
    [6.0, 0.0, -0.145_749_861_944_416e-3],
];

pub(crate) fn t_ps_3b(p: Pressure, s: SpecificHeatCapacity) -> SpecificVolume {

    let v_ref = SpecificVolume::new::<cubic_meter_per_kilogram>(0.0088);
    let p_ref = Pressure::new::<megapascal>(100.0);
    let s_ref = SpecificHeatCapacity::new::<kilojoule_per_kilogram_kelvin>(5.3);

    let sigma: f64 = (s/s_ref).get::<ratio>();
    let pi: f64 = (p/p_ref).get::<ratio>();

    let mut omega = 0.0;

    for coeffs in T_PS_SUBREGION_3B_COEFFS {
        let ii = coeffs[0];
        let ji = coeffs[1];
        let ni = coeffs[2];

        omega += ni * (pi + 0.298).powf(ii) * (sigma - 0.816).powf(ji);
    };

    return omega * v_ref;
}

const T_PS_SUBREGION_3B_COEFFS: [[f64; 3]; 31] = [
    [-12.0, 0.0, 0.591_599_780_322_238e-4],
    [-12.0, 1.0, -0.185_465_997_137_856e-2],
    [-12.0, 2.0, 0.104_190_510_480_013e-1],
    [-12.0, 3.0, 0.598_647_302_038_590e-2],
    [-12.0, 5.0, -0.771_391_189_901_699],
    [-12.0, 6.0, 0.172_549_765_557_036e1],
    [-10.0, 0.0, -0.467_076_079_846_526e-3],
    [-10.0, 1.0, 0.134_533_823_384_439e-1],
    [-10.0, 2.0, -0.808_094_336_805_495e-1],
    [-10.0, 4.0, 0.508_139_374_365_767],
    [-8.0, 0.0, 0.128_584_643_361_683e-2],
    [-5.0, 1.0, -0.163_899_353_915_435e1],
    [-5.0, 2.0, 0.586_938_199_318_063e1],
    [-5.0, 3.0, -0.292_466_667_918_613e1],
    [-4.0, 0.0, -0.614_076_301_499_537e-2],
    [-4.0, 1.0, 0.576_199_014_049_172e1],
    [-4.0, 2.0, -0.121_613_320_606_788e2],
    [-4.0, 3.0, 0.167_637_540_957_944e1],
    [-3.0, 1.0, -0.744_135_838_773_463e1],
    [-2.0, 0.0, 0.378_168_091_437_659e-1],
    [-2.0, 1.0, 0.401_432_203_027_688e1],
    [-2.0, 2.0, 0.160_279_837_479_185e2],
    [-2.0, 3.0, 0.317_848_779_347_728e1],
    [-2.0, 4.0, -0.358_362_310_304_853e1],
    [-2.0, 12.0, -0.115_995_260_446_827e7],
    [0.0, 0.0, 0.199_256_573_577_909],
    [0.0, 1.0, -0.122_270_624_794_624],
    [0.0, 2.0, -0.191_449_143_716_586e2],
    [1.0, 0.0, -0.150_448_002_905_284e-1],
    [1.0, 2.0, 0.146_407_900_162_154e2],
    [2.0, 2.0, -0.327_477_787_188_230e1],
];



